<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
	integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
	crossorigin="anonymous">

<!--  Datatables  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />

<!--  extension responsive  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">

<title>Listado de Estadisticas</title>
<link rel="icon" type="image/png" href="https://images.vexels.com/media/users/3/181410/isolated/preview/eb4635102ef855d3f98d7805ec155a77-icono-de-deportes-de-pelota-de-voleibol-by-vexels.png" />
</head>
<body class="bg-light">
	
	<script src="https://www.w3schools.com/lib/w3data.js"></script>
	
	<div class="">
	<div w3-include-html="navbar?id=estadisticasPartido"></div>
	</div>
	
	<script type="text/javascript">
       w3IncludeHTML();
	</script>

	<div class="container-fluid">
		<div class="row">
			<div class="py-3 text-center col-lg-2">
				
			</div>
			<div class="py-3 text-center col-lg-8">
				<h1 class="font-weight-bold font-italic">ESTADISITICAS PARTIDOS</h1>
			</div>
			
	<!-- Este es el selector de equipo -->
			<div class="py-3 mt-2 text-center col-lg-2">
				<select id="equipo" class="form-control border border-info">
					<th:block th:each="categoria : ${categorias}">
						<option th:value="${categoria}" th:text="${categoria}"></option>
					</th:block>
				</select>
			</div>
		</div>

		<div class="row">
		
		<!-- Todos estos son los botones que aparecen debajo del título para cambiar entre General y cualquier estadística concreta -->
			<div class="col">
				<input type="hidden" id="id" th:value="general">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">GENERAL</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="saque">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">SAQUES</button>
			</div>

			<div class="col">
				<input type="hidden" id="id" th:value="recepcion">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">RECEPCIONES</button>
			</div>

			<div class="col">
				<input type="hidden" id="id" th:value="colocacion">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">COLOCACIONES</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="defensa">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">DEFENSAS</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="bloqueo">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">BLOQUEOS</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="remate">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">REMATES</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="finta">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">FINTAS</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="ataque">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">ATAQUES R</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="tiempos">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">TIEMPOS S_JUEGO</button>
			</div>
		</div>

		<div class="row">
						
			<div class="col-lg-12 responsive">
				<table id="estadisiticas"
					class="table table-sm table-striped table-bordered table-hover nowrap"
					cellspacing="0" style="width: 100%;">
					<thead>
						<tr class="table-primary">
							
							<th>FECHA</th>
							<th>HORA</th>
							<th title="Saques Acertados">Saq A</th>
							<th title="Saques Totales">Saq T</th>
							<th title="Porcentaje Saques"> % Saq</th>
							
							<th title="Recepciones Acertados">Rec A</th>
							<th title="Recepciones Totales">Rec T</th>
							<th title="Porcentaje Recepciones">% Rec</th>
							
							<th title="Colocaciones Acertados">Col A</th>
							<th title="Colocaciones Totales">Col T</th>
							<th title="Porcentaje Colocaciones">% Col</th>
						
							<th title="Defensas Acertados">Def A</th>
							<th title="Defensas Totales">Def T</th>
							<th title="Porcentaje Defensas">% Def</th>
							
							<th title="Bloqueos Acertados">Blo A</th>
							<th title="Bloqueos Totales">Blo T</th>
							<th title="Porcentaje Bloqueos">% Blo</th>
							
							<th title="Remates Acertados">Rem A</th>
							<th title="Remates Totales">Rem T</th>
							<th title="Porcentaje Remates">% Rem</th>
							
							<th title="Fintas Acertados">Fin A</th>
							<th title="Fintas Totales">Fin T</th>
							<th title="Porcentaje Fintas">% Fin</th>
							
							<th title="Ataques Rápidos Acertados">AtR A</th>
							<th title="Ataques Rápidos Totales">AtR T</th>
							<th title="Porcentaje Ataques Rápidos">% AtR</th>
							<th>5_1</th>
							<th>4_2</th>
							<th>6_2</th>
							<th>Equipo</th>
							<th>Jug</th>
							
							
						</tr>
					</thead>
				</table>
			</div>
		</div>
		
	</div>

					

	<script src=https://code.jquery.com/jquery-3.5.1.js></script>
	<!-- Optional JavaScript -->
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

	<!--   Datatables-->
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

	<!-- extension responsive -->
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
		
	<script type="text/javascript"
		src="//code.highcharts.com/highcharts.js"></script>
		
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>
	
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
	
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
	
	<script type="text/javascript">
	/** 
	 * 
	 */
	 //Función para reenviar a otras estadísticas tras pulsar el botón en la tabla (columna Jug)
	 function statsTodos(id){
			
			window.location.href = "/partidos/showestadisiticasPartidoTodosJugadores?id="+id;
		}
		  
	$(document).ready(function () {
			//Obtenemos el nombre del equipo que ha sido seleccionado
			var equipo = $(this).find("option:selected").attr('value'); 
			
			//equipo es el id del selector de equipo y en caso de cambie, destruimos la tabla, creamos una nueva con ajax, con los datos del equipo elegido
			// y al final del todo actualizamos el gráfico con crearGrafica
			$('#equipo').change(function(){
					var equipo = $(this).find("option:selected").attr('value'); 
					
					table.destroy();
					
					table = $('#estadisiticas').DataTable({
				    	"lengthMenu" : [5,6,7,8,9,10],
						language : {
							emptyTable : "Ningún dato disponible en esta tabla",
							"info" : "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
							"infoEmpty" : "Mostrando 0 de 0 registros",
							"lengthMenu" : "Mostrando _MENU_ registros",
							"search" : "Buscar:",
							"zeroRecords" : "No se encontraron resultados",
							"paginate" : {
								"first" : "Primera",
								"last" : "Última",
								"next" : "Siguiente",
								"previous" : "Anterior"
							},
						},
						ajax:'[[@{/partidos/findestadisticasPartidos/}]]'+ equipo,
						columns:[
							{data:'fecha'},
							{data:'hora'},
							{data:'saquesAcertados'},
							{data:'saquesTotales'},
							{data:'porcentajeSaques',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'recepcionesAcertadas'},
							{data:'recepcionesTotales'},
							{data:'porcentajeRecepciones',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'colocacionesAcertadas'},
							{data:'colocacionesTotales'},
							{data:'porcentajeColocaciones',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'defensasAcertadas'},
							{data:'defensasTotales'},
							{data:'porcentajeDefensas',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'bloqueosAcertados'},
							{data:'bloqueosTotales'},
							{data:'porcentajeBloqueos',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'rematesAcertados'},
							{data:'rematesTotales'},
							{data:'porcentajeRemates',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'fintasAcertadas'},
							{data:'fintasTotales'},
							{data:'porcentajeFintas',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'numAtaquesRapidosAcertados'},
							{data:'numAtaquesRapidosTotales'},
							{data:'porcentajeAtaquesRapidos',
								 render: function ( data, type, row ) {
									    return data*100 +"%";
										}
							},
							{data:'tiempo51'},
							{data:'tiempo42'},
							{data:'tiempo62'},
							{data:'categoria'},
							{data: 'id',
								render:function ( data, type, row ) {
							
								
							
							return	'<button class="btn btn-outline-success mx-0 jugadores" type="button" onclick="return statsTodos('+data+')" title="Estadísticas"><svg width="1.2em" height=1.2em viewBox="0 0 16 16" class="bi bi-graph-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">'+
								'<path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5z"/>'+
								'</svg> </button>';
								}
							}
							
						],
				        responsive: true,
				        columnDefs : [ {
							responsivePriority : 1,
							targets : 0 //Fehca
						}, {
							responsivePriority : 1,
							targets : 1 //Hora
						}, {
							responsivePriority : 2,
							targets : -1, //Botón
							orderable:false
						}, {
							responsivePriority : 5,
							targets : 2 //SAQUE
							,orderable:false
						}, {
							responsivePriority : 6,
							targets : 3
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 4
							,orderable:false
						}, {
							responsivePriority : 7,
							targets : 5 //RECEPCION
							,orderable:false
						}, {
							responsivePriority : 8,
							targets : 6
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 7
							,orderable:false
						}, {
							responsivePriority : 9,
							targets : 8 //COLOCACION
							,orderable:false
						}, {
							responsivePriority : 10,
							targets : 9
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 10
							,orderable:false
						}, {
							responsivePriority : 11,
							targets : 11 //DEFENSA
							,orderable:false
						}, {
							responsivePriority : 12,
							targets : 12
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 13
							,orderable:false
						}, {
							responsivePriority : 13,
							targets : 14 //BLOQUEO
							,orderable:false
						}, {
							responsivePriority : 14,
							targets : 15
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 16
							,orderable:false
						}, {
							responsivePriority : 100,
							targets : 17 //REMATE
							,orderable:false
						}, {
							responsivePriority : 100,
							targets : 18
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 19
							,orderable:false
						}, {
							responsivePriority : 100,
							targets : 20 //FINTAS
							,orderable:false
						}, {
							responsivePriority : 100,
							targets : 21
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 22
							,orderable:false
						}, {
							responsivePriority : 100,
							targets : 23 //ATAQUES
							,orderable:false
						}, {
							responsivePriority : 100,
							targets : 24
							,orderable:false
						}, {
							responsivePriority : 3,
							targets : 25
							,orderable:false
						}, {
							className: 'none',
							targets : 26 //TIEMPOS
							,orderable:false
						}, {
							className: 'none',
							targets : 27
							,orderable:false
						}, {
							className: 'none',
							targets : 28
							,orderable:false
						}, {
							className: 'none',
							targets : 29
							,orderable:false,
							visible:false
						}]
				    });
					
					//table.ajax.reload();
						crearGrafica(5,0);
						numRegistros = 5;
					 
					 
		          });
			
			  
			
			//Aquí creamos el DataTable con ajax, con sus columns, columnsDefs y demás
		    var table = $('#estadisiticas').DataTable({
		    	"lengthMenu" : [5,6,7,8,9,10],
				language : {
					emptyTable : "Ningún dato disponible en esta tabla",
					"info" : "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
					"infoEmpty" : "Mostrando 0 de 0 registros",
					"lengthMenu" : "Mostrando _MENU_ registros",
					"search" : "Buscar:",
					"zeroRecords" : "No se encontraron resultados",
					"paginate" : {
						"first" : "Primera",
						"last" : "Última",
						"next" : "Siguiente",
						"previous" : "Anterior"
					},
				},
				ajax:'[[@{/partidos/findestadisticasPartidos/}]]'+ equipo,
				columns:[
					{data:'fecha'},
					{data:'hora'},
					{data:'saquesAcertados'},
					{data:'saquesTotales'},
					{data:'porcentajeSaques',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'recepcionesAcertadas'},
					{data:'recepcionesTotales'},
					{data:'porcentajeRecepciones',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'colocacionesAcertadas'},
					{data:'colocacionesTotales'},
					{data:'porcentajeColocaciones',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'defensasAcertadas'},
					{data:'defensasTotales'},
					{data:'porcentajeDefensas',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'bloqueosAcertados'},
					{data:'bloqueosTotales'},
					{data:'porcentajeBloqueos',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'rematesAcertados'},
					{data:'rematesTotales'},
					{data:'porcentajeRemates',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'fintasAcertadas'},
					{data:'fintasTotales'},
					{data:'porcentajeFintas',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'numAtaquesRapidosAcertados'},
					{data:'numAtaquesRapidosTotales'},
					{data:'porcentajeAtaquesRapidos',
						 render: function ( data, type, row ) {
							    return data*100 +"%";
								}
					},
					{data:'tiempo51'},
					{data:'tiempo42'},
					{data:'tiempo62'},
					{data:'categoria'},
					{data: 'id',
						render:function ( data, type, row ) {
					
						
					
					return	'<button class="btn btn-outline-success mx-0 jugadores" type="button" onclick="return statsTodos('+data+')" title="Estadísticas"><svg width="1.2em" height=1.2em viewBox="0 0 16 16" class="bi bi-graph-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">'+
						'<path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5z"/>'+
						'</svg> </button>';
						}
					}
					
				],
		        responsive: true,
		        columnDefs : [ {
					responsivePriority : 1,
					targets : 0 //Fehca
				}, {
					responsivePriority : 1,
					targets : 1 //Hora
				}, {
					responsivePriority : 2,
					targets : -1, //Botón
					orderable:false
				}, {
					responsivePriority : 5,
					targets : 2 //SAQUE
					,orderable:false
				}, {
					responsivePriority : 6,
					targets : 3
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 4
					,orderable:false
				}, {
					responsivePriority : 7,
					targets : 5 //RECEPCION
					,orderable:false
				}, {
					responsivePriority : 8,
					targets : 6
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 7
					,orderable:false
				}, {
					responsivePriority : 9,
					targets : 8 //COLOCACION
					,orderable:false
				}, {
					responsivePriority : 10,
					targets : 9
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 10
					,orderable:false
				}, {
					responsivePriority : 11,
					targets : 11 //DEFENSA
					,orderable:false
				}, {
					responsivePriority : 12,
					targets : 12
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 13
					,orderable:false
				}, {
					responsivePriority : 13,
					targets : 14 //BLOQUEO
					,orderable:false
				}, {
					responsivePriority : 14,
					targets : 15
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 16
					,orderable:false
				}, {
					responsivePriority : 100,
					targets : 17 //REMATE
					,orderable:false
				}, {
					responsivePriority : 100,
					targets : 18
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 19
					,orderable:false
				}, {
					responsivePriority : 100,
					targets : 20 //FINTAS
					,orderable:false
				}, {
					responsivePriority : 100,
					targets : 21
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 22
					,orderable:false
				}, {
					responsivePriority : 100,
					targets : 23 //ATAQUES
					,orderable:false
				}, {
					responsivePriority : 100,
					targets : 24
					,orderable:false
				}, {
					responsivePriority : 3,
					targets : 25
					,orderable:false
				}, {
					className: 'none',
					targets : 26 //TIEMPOS
					,orderable:false
				}, {
					className: 'none',
					targets : 27
					,orderable:false
				}, {
					className: 'none',
					targets : 28
					,orderable:false
				}, {
					className: 'none',
					targets : 29
					,orderable:false,
					visible:false
				}]
		    });
			
		    var chart = null;
		    var tipo = null;
		    var numRegistros = 5;
		    var page = 0;
		    
		    //La gráfica que se muestra siempre que se entra es la gráfica de estadísticas generales del partido que estemos viendo
		    // numRegistros indica el número de registros que se muestran en el dataTable y page indica el número de la página en la
		    // que estamos del datatable, estos datos los usamos dentro de las funciones para calcular que datos concretamente deben
		    // mostrarse en la gráfica según los datos y configuración de la tabla.

		    graficaGeneral(table,'general',numRegistros,page);
		   
		    // Aquí detectamos cuando se pulsa uno de los botones de justo debajo del título, se destruye el gráfico 
		    // que haya actualmente y se crea uno según el tipo pulsado, mostrando o ocultando las columnas necesarias
		    // la función columna oculta y muestra columnas según cual sea el tipo concreto de estadística que hayamos pulsado.
		    
		    $('.stats').on('click', function(){
				tipo = $(this).parent().find('#id').val(); 
				
		 	if(chart != null){
		 		
		 		chart.destroy();
		 		
		 	}
		 	if (tipo == 'general'){
		 		
		 		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
	     		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
		 		graficaGeneral(table,tipo,numRegistros,page);
		 	
		 	}else if (tipo == 'tiempos'){
		 		
		 		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
	     		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
		 		graficaTiempos (table, tipo,numRegistros,page);
		 		
		 	}else{
		 		
		 		columnas(table,tipo);
		 		graficaEspecifica(table,tipo,numRegistros,page);
	     		
		 	}
		    });
		    
		    //Si cambiamos el número de registro a mostrar page pasa a ser 0 (página 1) y la variable numRegistros se actualiza
		    //con el valor que hayamos elegido entre 5 y 10, y actualizamos la gráfica (crearGráfica)
		    
		    $('#estadisiticas').on( 'length.dt', function ( e, settings, len ) {
		    	page = 0;
		        numRegistros = len;
		        console.log(numRegistros);
		        crearGrafica(numRegistros,page);
		    	
		    	console.log( 'New page length: '+len );
		 } );
		    
		    
		    //Aquí detectamos cuando se cambia de página y actualizamos la variable page con el número de página que hemos pulsado
		    $('#estadisiticas').on( 'draw.dt', function () {
		        var info = table.page.info();
		        console.log(info.page);
		        page = info.page;
		        crearGrafica(numRegistros,page);
		        //chart.reflow();
		        
		    });
		    
		    
		    //Si ordenamos la tabla por fecha simplemente actualizamos el gráfico
		    $('th').on('click', function(){
		    	 
		          crearGrafica(numRegistros,page);
		    });
		    
		 	
		    // Esta es la función crearGráfica que hemos nombrado varias veces, donde primero se destruye la gráfica si la hubiese
		    // Se actualizan las columnas visibles y no visibles y se crea la gráfica concreta según el tipo, numRegistros, page que
		    // hallamos elegido de alguna de las formas anteriormente vistas
		    
		    function crearGrafica(numRegistros,page){
		    	if(chart != null){
			 		chart.destroy();
			 		console.log("destruida");
			 		if(tipo == null){
			 			tipo = 'general';
			 		}
			 	}
			 	
		    	if (tipo == 'general'){
			 		
			 		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
		     		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
			 		graficaGeneral(table,tipo,numRegistros,page);
			 		
			 	
			 	}else if (tipo == 'tiempos'){
			 		
			 		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
		     		table.columns( [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(true);
			 		graficaTiempos (table, tipo,numRegistros,page);
			 		
			 	}else{
			 	
			 		columnas(table,tipo);
			 		graficaEspecifica(table,tipo,numRegistros,page);
			 		
		     		
			 	}
		    }
		    
		    
		    //Aquí creamos la primera de las gráficas
		    function graficaEspecifica (table, tipo,numRegistros,page){ 
		    
		    var container = $('<div/>').insertBefore(table.table().container());
		 
		     chart = Highcharts.chart(container[0], {
		        chart: {
		            type: 'column', //el tipo de la gráfica
		        },
		        title: {
		            text: name(table,tipo), //nombre de la gráfica según el tipo
		        },
		        xAxis: {
		            categories: fechas(table,numRegistros,page), //devuelve una lista con las fechas que salen en el eje x
		            crosshair: true
		        },
		        yAxis: [{ // Primary yAxis
		            labels: {
		                format: '{value}',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            },
		            title: {
		                text: 'Estadísticas',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            },
		            opposite: true
		        }, { // Secondary yAxis
		        	max: 100,
		        	min: 0,
		            title: {
		                text: 'Porcentaje',
		                style: {
		                    color: Highcharts.getOptions().colors[0]
		                }
		            },
		            labels: {
		                format: '{value} %',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            }
		        }],
		        tooltip: {
		            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
		            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
		                '<td style="padding:0"><b>{point.y:f}</b></td></tr>',
		            footerFormat: '</table>',
		            shared: true,
		            useHTML: true
		        },
		        plotOptions: {
		            column: {
		                pointPadding: 0.2,
		                borderWidth: 0
		            }
		        },
		        series: [  //A partir de aquí se describen las series
		        	
		        	{
		            	name: name1(table,tipo), //parecido a name
		            	data: chartData(table,tipo,numRegistros,page), //delvuelve los datos de acertados
		            	yAxis: 0
		            }, 
		            {
		            	name: name2(table,tipo), //parecido a name
		            	data: chartData2(table,tipo,numRegistros,page), //delvuelve los datos de totales
		            	yAxis: 0
		            }, 
		            {
		                type: 'spline',  // está sería en vez de ser de tipo columna es de tipo línea
		                name: 'Porcentaje',
		                data: chartData3(table,tipo,numRegistros,page), //delvuelve los datos de porcentaje
		                yAxis: 1,
		                tooltip: {
		                    valueSuffix: ' %'
		                },
		                marker: {
		                    lineWidth: 2,
		                    lineColor: Highcharts.getOptions().colors[3],
		                    fillColor: 'white'
		                }
		            }
		        ],
		    });
		    
		    }
		    
	//Creación gráfica tiempos Similar a la anterior cambiando algunos datos, y ahora la tercera serie no es Spline sino column	
	function graficaTiempos (table, tipo,numRegistros,page){ 
			    
			    var container = $('<div/>').insertBefore(table.table().container());
			 
			     chart = Highcharts.chart(container[0], {
			        chart: {
			            type: 'column',
			        },
			        title: {
			            text: name(table,tipo),
			        },
			        xAxis: {
			            categories: fechas(table,numRegistros,page),
			            crosshair: true
			        },
			        yAxis: { // Primary yAxis
			            labels: {
			                format: '{value}',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            },
			            title: {
			                text: 'Tiempo (min)',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            },
			            opposite: false
			        },
			        tooltip: {
			            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
			            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
			                '<td style="padding:0"><b>{point.y:f}</b></td></tr>',
			            footerFormat: '</table>',
			            shared: true,
			            useHTML: true
			        },
			        plotOptions: {
			            column: {
			                pointPadding: 0.2,
			                borderWidth: 0
			            }
			        },
			        series: [
			        	
			            {	            	
			            	name: 'Minutos 5_1',
			            	data: chartData(table,tipo,numRegistros,page),
			            	yAxis: 0
			            	
			            },
			            {
			            	name: 'Minutos 4_2',
			            	data: chartData2(table,tipo,numRegistros,page),
			            	yAxis: 0
			            }, 
			            {
			            	name: 'Minutos 6_2',
			            	data: chartData3(table,tipo,numRegistros,page),
			            	yAxis: 0
			            }
			        ],
			    });
			    

			    }
	
	//Creación Gráfica general
	 function graficaGeneral (table, tipo, numRegistros,page){ 
		    
		    var container = $('<div/>').insertBefore(table.table().container());
		 
		     chart = Highcharts.chart(container[0], {
		    	 chart: {
			            type: 'spline', //esta es de tipo linea
			        },
		        title: {
		            text: 'Estadística',
		        },
		        xAxis: {
		            categories: fechas(table,numRegistros,page), //procedimiento similar a la gráfica específica
		            crosshair: true,
		            max: fechas(table,numRegistros,page).length -1
		        },
		        yAxis:  {
		        	max: 100,
		        	min: 0,
		            title: {
		                text: 'Porcentaje',
		                style: {
		                    color: Highcharts.getOptions().colors[0]
		                }
		            },
		            labels: {
		                format: '{value} %',
		                style: {
		                    color: Highcharts.getOptions().colors[1]
		                }
		            }
		        },
		        
		        legend: {
		            layout: 'vertical',
		            align: 'right',
		            verticalAlign: 'middle'
		        },
		        plotOptions: {
		            series: {
		                pointPadding: 0.2,
		                borderWidth: 0
		            }
		        },
		   
		        series: [ // A diferencia de la gráfica anterior aquí las series son los porcentajes de cada una de las estadísticas
		            {	            	
		            	name: 'Porcentaje Saques',
		            	data: datos(table,'saque',numRegistros,page), 
		            	
		            },
		            {
		            	name: 'Porcentaje Recepciones',
		            	data: datos(table,'recepcion',numRegistros,page)
		            },
		            {	            	
		            	name: 'Porcentaje Colocaciones',
		            	data: datos(table,'colocacion',numRegistros,page)
		            	
		            },
		            {
		            	name: 'Porcentaje Defensas',
		            	data: datos(table,'defensa',numRegistros,page)
		            },  
		            {	            	
		            	name: 'Porcentaje Bloqueo',
		            	data: datos(table,'bloqueo',numRegistros,page)
		            	
		            },
		            {
		            	name: 'Porcentaje Remate',
		            	data: datos(table,'remate',numRegistros,page)
		            }, 
		            {	            	
		            	name: 'Porcentaje Fintas',
		            	data: datos(table,'finta',numRegistros,page)
		            	
		            },
		            {
		            	name: 'Porcentaje Ataques Rápidos',
		            	data: datos(table,'ataque',numRegistros,page)
		            }, 
		        ],
		        
		        responsive: {
		            rules: [{
		                condition: {
		                    maxWidth: 500
		                },
		                chartOptions: {
		                    legend: {
		                        layout: 'horizontal',
		                        align: 'center',
		                        verticalAlign: 'bottom'
		                    }
		                }
		            }]
		        }
		    });
		    
		    }
		
	
	});
		
	
 // FUNCTIONS	
 			
 			//Función usado en grafica general
 			function datos (table,tipo,numRegistros,page){
 						
	 			var dato = [];

	 			var contador = 0;
				var columna = 0;
				
				//Vemos de que columna es de la que vemos a crear la serie según el tipo que llega como parámetro
		     	if (tipo == 'saque'){
		     		columna = 4;
		     	} else if(tipo == 'recepcion'){
		     		columna = 7;
		     	}else if(tipo == 'colocacion'){
		     		columna = 10;
		     	}else if (tipo == 'defensa'){
					columna = 13;
		     	}else if (tipo == 'bloqueo'){
					columna = 16;
				}else if (tipo == 'remate'){
					columna = 19;
				}else if (tipo == 'finta'){
					columna = 22;
				}else if (tipo == 'ataque'){
					columna = 25;
				}
		     	

	 			
		     	 contador = 0;
		     	 //recorremos la columna de tabla y añadimos solo aquellos que están dentro del paginado de la tabla
 				 table
		            .column(columna, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	
		            	if(contador >= numRegistros*page && dato.length < numRegistros){
		            		
		            		dato.push( parseFloat(val*100));
		            	}else{
		            		contador++;
		            	}
		            });
 				 
				return dato;
			}
	
 			//Funciones de nombres no son complejas	
			function name1(table,tipo){
				
				if(tipo == 'saque'){
					return 'Saques Acertados';
				}else if (tipo == 'recepcion'){
					return 'Recepciones Acertadas';
				}else if(tipo == 'colocacion'){
					return 'Colocaciones Acertadas'
				}else if (tipo == 'defensa'){
					return 'Defensas Acertadas'
				}else if (tipo == 'bloqueo'){
					return 'Bloqueos Acertados'
				}else if (tipo == 'remate'){
					return 'Remates Acertadas'
				}else if (tipo == 'finta'){
					return 'Fintas Acertadas'
				}else if (tipo == 'ataque'){
					return 'Ataques Rápidos Acertados'
				}
			}
			
			function name2(table,tipo){
				
				
				if(tipo == 'saque'){
					return 'Saques Totales';
				}else if (tipo == 'recepcion'){
					return 'Recepciones Totales';
				} else if(tipo == 'colocacion'){
					return 'Colocaciones Totales'
				}else if (tipo == 'defensa'){
					return 'Defensas Totales'
				}else if (tipo == 'bloqueo'){
					return 'Bloqueos Totales'
				}else if (tipo == 'remate'){
					return 'Remates Totales'
				}else if (tipo == 'finta'){
					return 'Fintas Totales'
				}else if (tipo == 'ataque'){
					return 'Ataques Rápidos Totales'
				}
			}
			
			function name(table,tipo){
				
				
				if(tipo == 'saque'){
					return 'SAQUES';
				}else if (tipo == 'recepcion'){
					return 'RECEPCIONES';
				}else if(tipo == 'colocacion'){
					return 'COLOCACIONES'
				}else if (tipo == 'defensa'){
					return 'DEFENSAS'
				}else if (tipo == 'bloqueo'){
					return 'BLOQUEOS'
				}else if (tipo == 'remate'){
					return 'REMATES'
				}else if (tipo == 'finta'){
					return 'FINTAS'
				}else if (tipo == 'ataque'){
					return 'ATAQUES RÁPIDOS'
				}
			}
			//Calculamos los datos de acertados o de tiempo 5-1 según la gráfica elegida
		    function chartData(table,tipo,numRegistros,page) {
		        var counts = {};
		     	var fechas = [];
		     	var horas = [];
		     	var dato = [];
		     	var contador = 0;
		     	var columna = 0;
		     	var contCounts = 0;
		     	var equipo = [];
		     	
		     	if (tipo == 'saque'){
		     		columna = 2;
		     	} else if(tipo == 'recepcion'){
		     		columna = 5;
		     	}else if (tipo == 'colocacion'){
		     		columna = 8;
		     	}else if (tipo == 'defensa'){
					columna = 11;
				}else if (tipo == 'bloqueo'){
					columna = 14;
				}else if (tipo == 'remate'){
					columna = 17;
				}else if (tipo == 'finta'){
					columna = 20;
				}else if (tipo == 'ataque'){
					columna = 23;
				}else if (tipo == 'tiempos'){
					columna = 26;
				}
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fechas.push( val);
		            });
		        
		        table
	            .column(1, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	horas.push( val);
	            });
		        
		        table
	            .column(columna, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseInt(val,10));
	            });
		        
		        table
	            .column(29, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	equipo.push(val);
	            });
		      
				for (i = 0; i < fechas.length; i++){
		        	
		        	if(contador >= numRegistros*page && contCounts < numRegistros){
		        		
		        		counts[fechas[i]+" "+horas[i]+ " "+ equipo[i]] = dato[i];
		        		console.log(counts);
		        		contCounts++;
		        	}else{
		        			
		        			contador++;
		        	}
		        }
		        
		     	
		        // And map it to the format highcharts uses
				 return $.map(counts, function (val, key) {
			            return {
			                name: key,
			                y: val,
			            };
			        });
		    }
		    
		    //Calculamos los datos de Totales o de tiempo 4-2 según la gráfica elegida
		    function chartData2(table,tipo,numRegistros,page) {
		    	 var counts = {};
			     	var fechas = [];
			     	var horas = [];
			     	var dato = [];
			     	var contador = 0;
					var columna = 0;
					var contCounts = 0;
					var equipo = [];
				
		     	if (tipo == 'saque'){
		     		columna = 3;
		     	} else if(tipo == 'recepcion'){
		     		columna = 6;
		     	} else if (tipo == 'colocacion'){
		     		columna = 9;
		     	}else if (tipo == 'defensa'){
					columna = 12;
		     	}else if (tipo == 'bloqueo'){
					columna = 15;
				}else if (tipo == 'remate'){
					columna = 18;
				}else if (tipo == 'finta'){
					columna = 21;
				}else if (tipo == 'ataque'){
					columna = 24;
				}else if (tipo == 'tiempos'){
					columna = 27;
				}					
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fechas.push(val);
		            });
		        
		        table
	            .column(1, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	horas.push( val);
	            });
		        
		        table
	            .column(columna, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseInt(val,10));
	            });
		        
		        table
	            .column(29, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	equipo.push(val);
	            });
		        
     			for (i = 0; i < fechas.length; i++){
		        	
		        	if(contador >= numRegistros*page && contCounts < numRegistros){
		        		
		        		counts[fechas[i]+" "+horas[i]+ " "+ equipo[i]] = dato[i];
		        		console.log(counts);
		        		contCounts++;
		        	}else{
		        			
		        			contador++;
		        	}
		        }
		        
		     
		        // And map it to the format highcharts uses
		        return $.map(counts, function (val, key) {
		            return {
		                name: key,
		                y: val,
		            };
		        });
		        
		    }
		  //Usamos misma metodologia que en otros casos para calcular la tercera serie  de las gráficas de especifica y tiempos
		  // con algunas diferencias según cual sea de la que queremos obtener los datos
		    function chartData3(table,tipo,numRegistros,page) {
		        var counts = {};
		     	var fechas = [];
		     	var horas = [];
		     	var dato = [];
		     	var contador = 0;
				var columna = 0;
				var contCounts = 0;
				var equipo = [];
		     	
		     	if (tipo == 'saque'){
		     		columna = 4;
		     	} else if(tipo == 'recepcion'){
		     		columna = 7;
		     	}else if(tipo == 'colocacion'){
		     		columna = 10;
		     	}else if (tipo == 'defensa'){
					columna = 13;
		     	}else if (tipo == 'bloqueo'){
					columna = 16;
				}else if (tipo == 'remate'){
					columna = 19;
				}else if (tipo == 'finta'){
					columna = 22;
				}else if (tipo == 'ataque'){
					columna = 25;
				}else if (tipo == 'tiempos'){
					columna = 28;
				}
		        
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fechas.push( val);
		            });
		        
		        table
	            .column(1, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	horas.push( val);
	            });
		        
		        table
	            .column(columna, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseFloat(val));
	            });
		       
		        table
	            .column(29, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	equipo.push(val);
	            });
		      
				for (i = 0; i < fechas.length; i++){
		        	
		        	if(contador >= numRegistros*page && contCounts < numRegistros){
		        		if(tipo != "tiempos")
		        			counts[fechas[i]+" "+horas[i]+ " "+ equipo[i]] = dato[i]*100;
		        		else
		        			counts[fechas[i]+" "+horas[i]+ " "+ equipo[i]] = dato[i];
		        		console.log(counts);
		        		contCounts++;
		        	}else{
		        			
		        			contador++;
		        	}
		        }
		        
		        // And map it to the format highcharts uses
		        return $.map(counts, function (val, key) {
		            return {
		                name: key,
		                y: val,
		            };
		        });
		        
		       
		    }
			
		    //Usamos misma metodologia que en otros casos para calcular las fechas del gráfico
		    function fechas(table,numRegistros,page) {
		        
		     	var fecha = [];
		     	var contador = 0;
		     	
		     	console.log(numRegistros)
		     	console.log(page)
		     	console.log(numRegistros*page)
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	if(contador >= numRegistros*page && fecha.length < numRegistros)
		            		fecha.push( val);
		            	else{
		            		contador++;
		            	}
		            });
		       console.log(fecha);
		        // And map it to the format highcharts uses
		        return fecha;
		    }
		    
		    //Función columnas usado para hacer visible o invisibles determinadas columnas según el tipo de estadísitcas que hayamos seleccionado
		    function columnas(table,tipo){
		    	
		    	var column = table.column(2);
		    	column.visible(false);
		    	
		    	if (tipo == 'saque'){
		     		table.columns( [2,3,4]).visible(true);
		     		table.columns( [2,3,4]).visible(true);
		     		table.columns( [5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(false);
		     	} else if(tipo == 'recepcion'){
		     		table.columns( [5,6,7]).visible(true);
		     		table.columns( [5,6,7]).visible(true);
		     		table.columns( [2,3,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(false);
		     	}else if(tipo == 'colocacion'){
		     		table.columns( [8,9,10]).visible(true);
		     		table.columns( [8,9,10]).visible(true);
		     		table.columns( [5,6,7,2,3,4,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]).visible(false);
		     	}else if (tipo == 'defensa'){
		     		table.columns( [11,12,13]).visible(true);
		     		table.columns( [11,12,13]).visible(true);
		     		table.columns( [5,6,7,8,9,10,2,3,4,14,15,16,17,18,19,20,21,22,23,24,25]).visible(false);
		     	}else if (tipo == 'bloqueo'){
		     		table.columns( [14,15,16]).visible(true);
		     		table.columns( [14,15,16]).visible(true);
		     		table.columns( [5,6,7,8,9,10,11,12,13,2,3,4,17,18,19,20,21,22,23,24,25]).visible(false);
				}else if (tipo == 'remate'){
					table.columns( [17,18,19]).visible(true);
					table.columns( [17,18,19]).visible(true);
		     		table.columns( [5,6,7,8,9,10,11,12,13,14,15,16,2,3,4,20,21,22,23,24,25]).visible(false);
				}else if (tipo == 'finta'){
					table.columns( [20,21,22]).visible(true);
					table.columns( [20,21,22]).visible(true);
		     		table.columns( [5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,2,3,4,23,24,25]).visible(false);
				}else if (tipo == 'ataque'){
					table.columns( [23,24,25]).visible(true);
					table.columns( [23,24,25]).visible(true);
		     		table.columns( [5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,2,3,4]).visible(false);
				}
		    }
	</script>
	
	<script type="text/javascript">
	function abrirPassword() {
		$('#gestionPassword #oldPassword').val("");
		$('#gestionPassword #newPassword').val("");
		$('#gestionPassword #confirmPassword').val("");
		$('.error').text('');
		$('#gestionPassword .modal-header').css("color", "white");
		$('#gestionPassword .modal-title').text("Cambiar Contraseña");
		$('#gestionPassword').modal("show");
	};
	
	function enviarEdicionPassword() {
		var form = new FormData(document.getElementById('formPassword'));
		$.ajax({
			url : '/users/postpassword',
			type : 'post',
			data : form,
			processData : false,
			contentType : false,
			success : function(data) {
				$('#gestionPassword').modal("hide");
				location.reload();
				//toastSuccess("Personal creado con éxito");
			},
			error : function(data) {

				$('.error').text('');

				for (i = 0; i < data.responseJSON.length; i++) {

					var campo = data.responseJSON[i].field;
					$('.' + campo).text(data.responseJSON[i].defaultMessage);
				}
			}
		});
	};
	
</script>
</body>
</html>