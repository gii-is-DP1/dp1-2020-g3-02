<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
	integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
	crossorigin="anonymous">

<!--  Datatables  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.css" />

<!--  extension responsive  -->
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">
<title>Listado de Estadisticas</title>
<link rel="icon" type="image/png" href="https://images.vexels.com/media/users/3/181410/isolated/preview/eb4635102ef855d3f98d7805ec155a77-icono-de-deportes-de-pelota-de-voleibol-by-vexels.png" />
</head>
<body class="bg-light">
	
	<script src="https://www.w3schools.com/lib/w3data.js"></script>
	
	<div class="">
	<div w3-include-html="/navbar?id=estadisticasEntrenamiento"></div>
	</div>

	<div class="container-fluid">
		<div class="row">	
		
			<div class="pt-2 col-lg-2">
				<button onclick="history.back()" class="btn btn-outline-danger flex btn-lg mt-2" type="button">VOLVER</button>
			</div>
														
			<div class="py-3 text-center col-lg-8">
				<h1 class="font-weight-bold font-italic">Estadísticas de <span th:text="${estadisticas.Jugador.firstName}+' ' +${estadisticas.Jugador.lastName}"></span> entrenamiento <span th:text="${estadisticas.Entrenamiento.fecha}"></span></h1>
			</div>
		</div>

		<div class="row">
			
			<div class="col">
				<input type="hidden" id="id" th:value="general">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">GENERAL</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="saque">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">SAQUES</button>
			</div>

			<div class="col">
				<input type="hidden" id="id" th:value="recepcion">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">RECEPCIONES</button>
			</div>

			<div class="col">
				<input type="hidden" id="id" th:value="colocacion">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">COLOCACIONES</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="defensa">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">DEFENSAS</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="bloqueo">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">BLOQUEOS</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="remate">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">REMATES</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="finta">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">FINTAS</button>
			</div>
			
			<div class="col">
				<input type="hidden" id="id" th:value="ataque">
				<button class="btn btn-outline-info btn-sm btn-block stats" type="button">ATAQUES R</button>
			</div>
			
		</div>

		<div class="row">
			<div class="col-lg-12 responsive">
				<table id="estadisiticas"
					class="table table-sm table-striped table-bordered table-hover nowrap"
					cellspacing="0" style="width: 100%;">
					<thead>
						<tr class="table-primary">
							
							<th>Técnicas</th>
							<th>Acertados</th>
							<th>Totales</th>
							<th>Porcentaje</th>
							
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Saque</td>
							<td  th:text="${estadisticas.saquesAcertados}"></td>
							<td th:text="${estadisticas.saquesTotales}"></td>
							<td th:text="${estadisticas.porcentajeSaques}"></td>
						</tr>
						
						<tr>
							<td>Recepción</td>
							<td  th:text="${estadisticas.recepcionesAcertadas}"></td>
							<td th:text="${estadisticas.recepcionesTotales}"></td>
							<td th:text="${estadisticas.porcentajeRecepciones}"></td>
						</tr>
						
						<tr>
							<td>Colocación</td>
							<td  th:text="${estadisticas.colocacionesAcertadas}"></td>
							<td th:text="${estadisticas.colocacionesTotales}"></td>
							<td th:text="${estadisticas.porcentajeColocaciones}"></td>
						</tr>
						
						<tr>
							<td>Defensa</td>
							<td  th:text="${estadisticas.defensasAcertadas}"></td>
							<td th:text="${estadisticas.defensasTotales}"></td>
							<td th:text="${estadisticas.porcentajeDefensas}"></td>
						</tr>			
						
						<tr>
							<td>Bloqueos</td>
							<td  th:text="${estadisticas.bloqueosAcertados}"></td>
							<td th:text="${estadisticas.bloqueosTotales}"></td>
							<td th:text="${estadisticas.porcentajeBloqueos}"></td>
						</tr>	
						
						<tr>
							<td>Remates</td>
							<td  th:text="${estadisticas.rematesAcertados}"></td>
							<td th:text="${estadisticas.rematesTotales}"></td>
							<td th:text="${estadisticas.porcentajeRemates}"></td>
						</tr>	
						<tr>
							<td>Fintas</td>
							<td  th:text="${estadisticas.fintasAcertadas}"></td>
							<td th:text="${estadisticas.fintasTotales}"></td>
							<td th:text="${estadisticas.porcentajeFintas}"></td>
						</tr>	
						<tr>
							<td>Ataques_R</td>
							<td  th:text="${estadisticas.numAtaquesRapidosAcertados}"></td>
							<td th:text="${estadisticas.numAtaquesRapidosTotales}"></td>
							<td th:text="${estadisticas.porcentajeAtaquesRapidos}"></td>
						</tr>	
					</tbody>

				</table>
			</div>
		</div>
		
	</div>



	<script src=https://code.jquery.com/jquery-3.5.1.js></script>
	<!-- Optional JavaScript -->
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

	<!--   Datatables-->
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

	<!-- extension responsive -->
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
		
	<script type="text/javascript"
		src="//code.highcharts.com/highcharts.js"></script>
		
		
	<script type="text/javascript"
		src="https://cdn.datatables.net/v/bs4/dt-1.10.20/datatables.min.js"></script>
	
	<script
		src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
	
	
	<script type="text/javascript">
	/**
	 * 
	 */

	$(document).ready(function () {
		    // Create DataTable
		    var table = $('#estadisiticas').DataTable({
		        dom: '',
		        responsive: true,
		        order: [0],
		        "createdRow": function( row, data, dataIndex ) {
	                   if ( data["column_index"] == "column_value" ) {
	                       $( row ).css( "background-color", "Orange" );
	                       $( row ).addClass( "warning" );
	                   }
	               },
	               columnDefs : [ {
						responsivePriority : 1,
						targets : 1, //Acertados
						orderable:false
					}, {
						responsivePriority : 1,
						targets : 2, //Totales
						orderable:false
					}, {
						responsivePriority : 2,
						targets : 3, //Porcentaje
						orderable:false
					}]
		        
		    });
		    var chart = null;
		    var tipo = null; //poner var general
		    
		    graficaGeneral(table,'general');
		    
		    $('.stats').on('click', function(){
				tipo = $(this).parent().find('#id').val(); 
				
		 	if(chart != null){
		 		
		 		chart.destroy();
		 		
		 	}
		 	if (tipo == 'general'){
		 		
		 		graficaGeneral(table,tipo);
		 	
		 	}else{
		 	
		 		graficaEspecifica(table,tipo);
		 		
	     		
		 	}
		    });
		    
		    $('th').on('click', function(){
		    	if(chart != null){
			 		chart.destroy();
			 		if(tipo == null){
			 			tipo = 'general';
			 		}
			 	}
			 	
		    	if (tipo == 'general'){
			 		graficaGeneral(table,tipo);
			 	
			 	}else{
			 		
			 		graficaEspecifica(table,tipo);
			 		
		     		
			 	}
		    });
		 	
		    // Create the chart with initial data
		    
		    function graficaEspecifica (table, tipo){ 
			    
			    var container = $('<div/>').insertBefore(table.table().container());
			 
			     chart = Highcharts.chart(container[0], {
			        chart: {
			            type: 'column',
			        },
			        title: {
			            text: name(tipo),
			        },
			        xAxis: {
			            categories: categorias(table,tipo),
			            crosshair: true
			        },
			        yAxis: [{ // Primary yAxis
			            labels: {
			                format: '{value}',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            },
			            title: {
			                text: 'Estadísticas',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            },
			            opposite: true
			        }, { // Secondary yAxis
			        	max: 100,
			        	min: 0,
			            title: {
			                text: 'Porcentaje',
			                style: {
			                    color: Highcharts.getOptions().colors[0]
			                }
			            },
			            labels: {
			                format: '{value} %',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            }
			        }],
			        tooltip: {
			            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
			            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
			                '<td style="padding:0"><b>{point.y:f}</b></td></tr>',
			            footerFormat: '</table>',
			            shared: true,
			            useHTML: true
			        },
			        plotOptions: {
			            column: {
			                pointPadding: 0.2,
			                borderWidth: 0
			            }
			        },
			        series: [
			            {	            	
			            	name: 'Acertados',
			            	data: chartData(table,tipo,1),
			            	yAxis: 0
			            	
			            },
			            {
			            	name: 'Totales',
			            	data: chartData(table,tipo,2),
			            	yAxis: 0
			            }, 
			            {
			            	name: 'Porcentaje',
			            	data: chartData(table,tipo,3),
			            	yAxis: 1
			            }
			        ],
			    });
			    
			    table.on('draw', function () {
			        chart.series[0].setData(chartData(table));
			    });
			    }
		    
		
		    function graficaGeneral (table, tipo){ 
			    
			    var container = $('<div/>').insertBefore(table.table().container());
			 
			     chart = Highcharts.chart(container[0], {
			        chart: {
			            type: 'column',
			        },
			        title: {
			            text: "Estadísticas Personales Jugador",
			        },
			        xAxis: {
			            categories: fechas(table),
			            crosshair: true
			        },
			        yAxis: [{ // Primary yAxis
			            labels: {
			                format: '{value}',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            },
			            title: {
			                text: 'Estadísticas',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            },
			            opposite: true
			        }, { // Secondary yAxis
			        	max: 100,
			        	min: 0,
			            title: {
			                text: 'Porcentaje',
			                style: {
			                    color: Highcharts.getOptions().colors[0]
			                }
			            },
			            labels: {
			                format: '{value} %',
			                style: {
			                    color: Highcharts.getOptions().colors[1]
			                }
			            }
			        }],
			        tooltip: {
			            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
			            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
			                '<td style="padding:0"><b>{point.y:f}</b></td></tr>',
			            footerFormat: '</table>',
			            shared: true,
			            useHTML: true
			        },
			        plotOptions: {
			            column: {
			                pointPadding: 0.2,
			                borderWidth: 0
			            }
			        },
			        series: [
			            {	            	
			            	name: 'Acertados',
			            	data: chartTable(table,1),
			            	yAxis: 0
			            	
			            },
			            {
			            	name: 'Totales',
			            	data: chartTable(table,2),
			            	yAxis: 0
			            }, 
			            {
			            	name: 'Porcentaje',
			            	data: chartTable(table,3),
			            	yAxis: 1
			            }
			        ],
			    });
			    
			    table.on('draw', function () {
			        chart.series[0].setData(chartData(table));
			    });
			    }
	
	});
		
	
 // FUNCTIONS
 
 			function name(table,tipo){
				
				
				if(tipo == 'saque'){
					return 'SAQUES';
				}else if (tipo == 'recepcion'){
					return 'RECEPCIONES';
				}else if(tipo == 'colocacion'){
					return 'COLOCACIONES'
				}else if (tipo == 'defensa'){
					return 'DEFENSAS'
				}else if (tipo == 'bloqueo'){
					return 'BLOQUEOS'
				}else if (tipo == 'remate'){
					return 'REMATES'
				}else if (tipo == 'finta'){
					return 'FINTAS'
				}else if (tipo == 'ataque'){
					return 'ATAQUES RÁPIDOS'
				}
			}
 
 			function chartTable(table,tipo) {
		        var counts = {};
		        var nombre = [];
		     	var dato = [];
		        
		     			     	
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	nombre.push(val);
		            });
		        
		        table
	            .column(tipo, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseFloat(val,10));
	            });
		             
		        
		        for (i = 0; i < nombre.length; i++){
		        	if(tipo==3){
		        	counts[nombre[i]] = dato[i]*100;
		        	}else{
		        		counts[nombre[i]] = dato[i];
		        	}
		        }
		        
		     
		        // And map it to the format highcharts uses
		        return $.map(counts, function (val, key) {
		            return {
		                name: key,
		                y: val,
		            };
		        });
		    }
 			
				
		    function chartData(table,tipo,columna) {
		        var counts = {};
		     	var tecnicas = [];
		     	var horas = [];
		     	var dato = [];
		        
		     	table
	            .column(0, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	tecnicas.push( val);
	            });
		     			     	
		     	var fila = 1;
		     	
		     	if (tipo == 'saque'){
		     		fila = tecnicas.indexOf('Saque');
		     	} else if(tipo == 'recepcion'){
		     		fila = tecnicas.indexOf('Recepción');
		     	}else if (tipo == 'colocacion'){
		     		fila = tecnicas.indexOf('Colocación');
		     	}else if (tipo == 'defensa'){
		     		fila = tecnicas.indexOf('Defensa');
				}else if (tipo == 'bloqueo'){
					fila = tecnicas.indexOf('Bloqueos');
				}else if (tipo == 'remate'){
					fila = tecnicas.indexOf('Remates');
				}else if (tipo == 'finta'){
					fila = tecnicas.indexOf('Fintas');
				}else if (tipo == 'ataque'){
					fila = tecnicas.indexOf('Ataques_R');
				}
		        // Count the number of entries for each position
		        
		        
		        table
	            .column(columna, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	dato.push( parseFloat(val,10));
	            });
		        
		        if(columna==3){
		        	counts[tecnicas[fila]] = dato[fila]*100;
		        	}else{
		        		counts[tecnicas[fila]] = dato[fila];
		        	}
		        	
		        
		        
		     
		        // And map it to the format highcharts uses
		        return $.map(counts, function (val, key) {
		            return {
		                name: key,
		                y: val,
		            };
		        });
		    }
		    function fechas(table) {
		        
		     	var fecha = [];
		        
		        // Count the number of entries for each position
		        table
		            .column(0, { search: 'applied' })
		            .data()
		            .each(function (val) {
		            	fecha.push( val);
		            });
		        
		        // And map it to the format highcharts uses
		        return fecha;
		    }
		    
			function categorias(table,tipo) {
		        
		     	var fecha = [];
		        var tecnicas = [];
		     	
		     	
		     	table
	            .column(0, { search: 'applied' })
	            .data()
	            .each(function (val) {
	            	tecnicas.push( val);
	            });
		     			     	
		     	var fila = 1;
		     	
		     	if (tipo == 'saque'){
		     		fila = tecnicas.indexOf('Saque');
		     	} else if(tipo == 'recepcion'){
		     		fila = tecnicas.indexOf('Recepción');
		     	}else if (tipo == 'colocacion'){
		     		fila = tecnicas.indexOf('Colocación');
		     	}else if (tipo == 'defensa'){
		     		fila = tecnicas.indexOf('Defensa');
				}else if (tipo == 'bloqueo'){
					fila = tecnicas.indexOf('Bloqueos');
				}else if (tipo == 'remate'){
					fila = tecnicas.indexOf('Remates');
				}else if (tipo == 'finta'){
					fila = tecnicas.indexOf('Fintas');
				}else if (tipo == 'ataque'){
					fila = tecnicas.indexOf('Ataques_R');
				}
		     	
		     	fecha.push(tecnicas[fila]);
		        
		        // And map it to the format highcharts uses
		        return fecha;
		    }
		    
		   
	</script>
	
	<script type="text/javascript">
       w3IncludeHTML();
	</script>
	<script type="text/javascript">
	function abrirPassword() {
		$('#gestionPassword #oldPassword').val("");
		$('#gestionPassword #newPassword').val("");
		$('#gestionPassword #confirmPassword').val("");
		$('.error').text('');
		$('#gestionPassword .modal-header').css("color", "white");
		$('#gestionPassword .modal-title').text("Cambiar Contraseña");
		$('#gestionPassword').modal("show");
	};
	
	function enviarEdicionPassword() {
		var form = new FormData(document.getElementById('formPassword'));
		$.ajax({
			url : '/users/postpassword',
			type : 'post',
			data : form,
			processData : false,
			contentType : false,
			success : function(data) {
				$('#gestionPassword').modal("hide");
				toastSuccess("Contraseña actualizada con éxito");
			},
			error : function(data) {

				$('.error').text('');

				for (i = 0; i < data.responseJSON.length; i++) {

					var campo = data.responseJSON[i].field;
					$('.' + campo).text(data.responseJSON[i].defaultMessage);
				}
			}
		});
	};
	
</script>
</body>
</html>